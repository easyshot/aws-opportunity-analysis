# Product Specification: AWS Bedrock Partner Management System

## Overview
The AWS Bedrock Partner Management System is a serverless, AI-powered application for analyzing business opportunities, generating funding recommendations, and identifying follow-on opportunities. It leverages AWS Bedrock (Claude 3.5 Sonnet), Lambda, Athena, DynamoDB, and other AWS services to deliver real-time analytics and actionable insights through a modern web interface.

## User Flows
- **Opportunity Analysis**: Users enter opportunity details (customer, region, close date, name, description) and trigger an analysis. The system generates a SQL query, retrieves historical data, and uses Bedrock to produce a comprehensive analysis.
- **Settings Management**: Users configure truncation, SQL query limits, and analysis parameters via the frontend. These settings are honored end-to-end, impacting data processing and analysis results.
- **Debug & Monitoring**: Users and admins can access real-time debug panels, view data flow, and monitor system health and performance.

## Data Collection & Processing
- **Input**: Opportunity details collected via a validated form.
- **Processing**: SQL query generated by Bedrock, executed via Lambda/Athena. Results are truncated or limited based on user settings. Analysis is performed by Bedrock using the latest prompt configuration.
- **Output**: Six core analysis areas (methodology, findings, risk factors, similar projects, rationale, full analysis), summary metrics (ARR, MRR, launch date, duration, confidence, top services), funding and follow-on sections.

## User Interaction
- **Modern Dashboard**: Real-time validation, progress tracking, and interactive debug panels.
- **Settings UI**: Full control over truncation, query limits, and analysis parameters.
- **Export/Print**: Professional export and print functionality for reports.

## System Behavior
- **Error Handling**: Robust error handling with structured JSON responses, detailed logs, and standardized error messages ('ERROR: Data not received') for improved debugging and user experience.
- **Performance**: Lambda timeout extended to 30s; backend optimized for large datasets and real-time feedback.
- **Security**: IAM roles, encryption, secrets management, and compliance controls.
- **Monitoring**: CloudWatch, X-Ray, and custom endpoints for health and performance.

## Analysis Flow Summary
1. User submits opportunity details and settings.
2. Backend generates SQL query using Bedrock.
3. Lambda executes query; results are truncated/limited as per settings.
4. Bedrock analyzes data and returns structured results.
5. Frontend displays results, debug info, and allows export.

## User-Driven Settings Impact
- All truncation, query limits, and analysis parameters are user-configurable and respected throughout the workflow, ensuring transparency and control.

## New Capabilities (2025)
- **Enterprise & Multi-Environment Support**: Full AWS Organizations, Control Tower, and CI/CD pipeline implementation for seamless multi-account, multi-region deployments.
- **Disaster Recovery & Business Continuity**: Automated backup, cross-region replication, and failover with RTO/RPO objectives (RTO 15 min, RPO 1 hr, 99.9% availability).
- **Enhanced Debug Suite**: Real-time data flow tracing, advanced debug panels, and professional troubleshooting tools for both frontend and backend.
- **User-Driven Settings**: All truncation, SQL query limits, and analysis parameters are fully user-configurable and respected end-to-end.
- **Comprehensive Documentation**: Expanded user guides, workflow templates, and operational runbooks for enterprise deployment and troubleshooting.

## References
- For technical stack and AWS integration, see `.kiro/steering/tech.md`.
- For project structure and development guidelines, see `structure.md`. 

## 2025 Debug and Analysis Enhancements
- All model inference parameters (max tokens, temperature, etc.) are now managed exclusively in Bedrock prompt management, not in backend code.
- Nova Premier has been fully removed; only Claude 3.5 Sonnet is used for all analysis and query steps.
- Debug panels in the UI now show only the analysis prompt/model for analysis steps, ensuring transparency and accuracy.
- The backend and frontend have been updated to ensure that analysis debug sections (4 and 5) use only the analysis prompt and payload, never falling back to query prompt data.
- Enhanced debug extraction logic provides full prompt metadata (modelId, promptVersion, promptName, etc.) for the analysis step. 