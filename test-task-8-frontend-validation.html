<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 8: Advanced Features Frontend Validation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-header {
            background: #f7fafc;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .test-header h2 {
            margin: 0;
            color: #2d3748;
            font-size: 1.5rem;
        }
        
        .test-header p {
            margin: 5px 0 0 0;
            color: #718096;
        }
        
        .test-content {
            padding: 20px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #cbd5e0;
        }
        
        .test-item.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }
        
        .test-item.warning {
            border-left-color: #ed8936;
            background: #fffaf0;
        }
        
        .test-item.error {
            border-left-color: #f56565;
            background: #fff5f5;
        }
        
        .test-icon {
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .test-details {
            flex: 1;
        }
        
        .test-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .test-description {
            color: #718096;
            font-size: 0.9rem;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-warning {
            background: #ed8936;
            color: white;
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .status-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .status-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .log-output {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .feature-demo {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9fa;
        }
        
        .feature-demo h3 {
            color: #4a5568;
            margin-bottom: 15px;
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Task 8: Advanced Features Validation</h1>
            <p>Comprehensive testing of Nova Premier, funding analysis, follow-on opportunities, and export capabilities</p>
        </div>
        
        <div class="content">
            <div class="controls">
                <button class="btn btn-primary" onclick="runAllTests()">
                    <span id="runAllIcon">üß™</span> Run All Tests
                </button>
                <button class="btn btn-secondary" onclick="testNovaPremier()">
                    üî¨ Test Nova Premier
                </button>
                <button class="btn btn-secondary" onclick="testFundingAnalysis()">
                    üí∞ Test Funding Analysis
                </button>
                <button class="btn btn-secondary" onclick="testFollowOnAnalysis()">
                    üöÄ Test Follow-On Analysis
                </button>
                <button class="btn btn-secondary" onclick="testExportFeatures()">
                    üìä Test Export Features
                </button>
                <button class="btn btn-warning" onclick="clearResults()">
                    üóëÔ∏è Clear Results
                </button>
            </div>
            
            <div class="status-bar">
                <div class="status-fill" id="overallProgress"></div>
            </div>
            
            <div class="results-summary">
                <div class="metric-card">
                    <div class="metric-value" id="totalTests">0</div>
                    <div class="metric-label">Total Tests</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="passedTests">0</div>
                    <div class="metric-label">Passed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="failedTests">0</div>
                    <div class="metric-label">Failed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="warningTests">0</div>
                    <div class="metric-label">Warnings</div>
                </div>
            </div>
            
            <!-- Test Section 8.1: Nova Premier Integration -->
            <div class="test-section">
                <div class="test-header">
                    <h2>üî¨ Requirement 8.1: Nova Premier Model Integration</h2>
                    <p>Test enhanced analysis capabilities with Nova Premier model</p>
                </div>
                <div class="test-content">
                    <div class="feature-demo">
                        <h3>Nova Premier Analysis Demo</h3>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="demoNovaPremierBasic()">Basic Analysis</button>
                            <button class="btn btn-primary" onclick="demoNovaPremierComplex()">Complex Analysis</button>
                            <button class="btn btn-secondary" onclick="compareModels()">Compare Models</button>
                        </div>
                    </div>
                    <div id="novaPremierTests"></div>
                </div>
            </div>
            
            <!-- Test Section 8.2: Funding Analysis -->
            <div class="test-section">
                <div class="test-header">
                    <h2>üí∞ Requirement 8.2: Funding Analysis Workflow</h2>
                    <p>Validate funding analysis with real Bedrock responses</p>
                </div>
                <div class="test-content">
                    <div class="feature-demo">
                        <h3>Funding Analysis Demo</h3>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="demoFundingStandard()">Standard Funding</button>
                            <button class="btn btn-primary" onclick="demoFundingEnterprise()">Enterprise Funding</button>
                            <button class="btn btn-secondary" onclick="validateFundingWorkflow()">Validate Workflow</button>
                        </div>
                    </div>
                    <div id="fundingTests"></div>
                </div>
            </div>
            
            <!-- Test Section 8.3: Follow-On Opportunities -->
            <div class="test-section">
                <div class="test-header">
                    <h2>üöÄ Requirement 8.3: Follow-On Opportunity Analysis</h2>
                    <p>Test multi-step workflow for identifying future opportunities</p>
                </div>
                <div class="test-content">
                    <div class="feature-demo">
                        <h3>Follow-On Analysis Demo</h3>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="demoFollowOnBasic()">Basic Opportunities</button>
                            <button class="btn btn-primary" onclick="demoFollowOnAdvanced()">Advanced Opportunities</button>
                            <button class="btn btn-secondary" onclick="validateMultiStepWorkflow()">Multi-Step Workflow</button>
                        </div>
                    </div>
                    <div id="followOnTests"></div>
                </div>
            </div>
            
            <!-- Test Section 8.4: Rich Content Display -->
            <div class="test-section">
                <div class="test-header">
                    <h2>üé® Requirement 8.4: Rich Formatted Content Display</h2>
                    <p>Verify all analysis sections display rich formatted content</p>
                </div>
                <div class="test-content">
                    <div class="feature-demo">
                        <h3>Content Display Demo</h3>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="testAnalysisSections()">Test All Sections</button>
                            <button class="btn btn-secondary" onclick="testContentFormatting()">Test Formatting</button>
                            <button class="btn btn-secondary" onclick="testInteractiveElements()">Test Interactive Elements</button>
                        </div>
                    </div>
                    <div id="contentTests"></div>
                </div>
            </div>
            
            <!-- Test Section 8.5: Export and Print -->
            <div class="test-section">
                <div class="test-header">
                    <h2>üìä Requirement 8.5: Export and Print Capabilities</h2>
                    <p>Test export and print functionality with real analysis data</p>
                </div>
                <div class="test-content">
                    <div class="feature-demo">
                        <h3>Export & Print Demo</h3>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="testExportFunctionality()">Test Export</button>
                            <button class="btn btn-primary" onclick="testPrintFunctionality()">Test Print</button>
                            <button class="btn btn-secondary" onclick="validateDataIntegrity()">Validate Data Integrity</button>
                        </div>
                    </div>
                    <div id="exportTests"></div>
                </div>
            </div>
            
            <!-- Test Section 8.6: Performance Standards -->
            <div class="test-section">
                <div class="test-header">
                    <h2>‚ö° Requirement 8.6: Performance and Reliability Standards</h2>
                    <p>Ensure advanced features maintain performance and reliability</p>
                </div>
                <div class="test-content">
                    <div class="feature-demo">
                        <h3>Performance Testing Demo</h3>
                        <div class="demo-controls">
                            <button class="btn btn-primary" onclick="testResponseTimes()">Response Times</button>
                            <button class="btn btn-primary" onclick="testConcurrentRequests()">Concurrent Requests</button>
                            <button class="btn btn-secondary" onclick="testErrorHandling()">Error Handling</button>
                        </div>
                    </div>
                    <div id="performanceTests"></div>
                </div>
            </div>
            
            <div class="log-output hidden" id="logOutput"></div>
        </div>
    </div>

    <script>
        // Test state management
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0,
            details: []
        };

        // API configuration
        const API_BASE = 'http://localhost:8123';
        const FRONTEND_BASE = 'http://localhost:3123';

        // Test scenarios
        const TEST_SCENARIOS = {
            novaPremierBasic: {
                CustomerName: "TechCorp Solutions",
                region: "United States",
                closeDate: "2025-06-15",
                oppName: "Cloud Migration Initiative",
                oppDescription: "Large-scale enterprise cloud migration with AI/ML requirements, data analytics, and advanced security needs. Customer seeks to modernize legacy infrastructure and implement intelligent automation.",
                useNovaPremier: true
            },
            
            fundingStandard: {
                CustomerName: "MidSize Manufacturing",
                region: "Germany", 
                closeDate: "2025-07-20",
                oppName: "IoT Manufacturing Platform",
                oppDescription: "IoT-enabled manufacturing platform with predictive maintenance, supply chain optimization, and real-time monitoring capabilities.",
                industry: "manufacturing",
                customerSegment: "commercial"
            },
            
            followOnBasic: {
                CustomerName: "StartupTech Inc",
                region: "Canada",
                closeDate: "2025-05-30", 
                oppName: "MVP Development Platform",
                oppDescription: "Initial MVP development platform for startup focusing on rapid prototyping and market validation.",
                customerSegment: "startup"
            }
        };

        // Utility functions
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logOutput = document.getElementById('logOutput');
            const prefix = type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            
            logOutput.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            
            if (logOutput.classList.contains('hidden')) {
                logOutput.classList.remove('hidden');
            }
            
            console.log(`[${timestamp}] ${message}`);
        }

        function updateMetrics() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('warningTests').textContent = testResults.warnings;
            
            const progress = testResults.total > 0 ? ((testResults.passed + testResults.warnings) / testResults.total) * 100 : 0;
            document.getElementById('overallProgress').style.width = `${progress}%`;
        }

        function addTestResult(container, name, description, status, details = '') {
            const testItem = document.createElement('div');
            testItem.className = `test-item ${status}`;
            
            const icon = status === 'success' ? '‚úÖ' : status === 'warning' ? '‚ö†Ô∏è' : status === 'error' ? '‚ùå' : 'üîÑ';
            
            testItem.innerHTML = `
                <div class="test-icon">${icon}</div>
                <div class="test-details">
                    <div class="test-name">${name}</div>
                    <div class="test-description">${description}</div>
                    ${details ? `<div class="test-description" style="margin-top: 5px; font-style: italic;">${details}</div>` : ''}
                </div>
            `;
            
            document.getElementById(container).appendChild(testItem);
            
            // Update metrics
            testResults.total++;
            if (status === 'success') testResults.passed++;
            else if (status === 'error') testResults.failed++;
            else if (status === 'warning') testResults.warnings++;
            
            updateMetrics();
        }

        async function callAPI(endpoint, data) {
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                const duration = Date.now() - startTime;
                
                return { ...result, testDuration: duration };
                
            } catch (error) {
                const duration = Date.now() - startTime;
                throw { ...error, testDuration: duration };
            }
        }

        // Main test functions
        async function runAllTests() {
            const runButton = document.querySelector('button[onclick="runAllTests()"]');
            const originalContent = runButton.innerHTML;
            runButton.innerHTML = '<span class="loading"></span> Running Tests...';
            runButton.disabled = true;
            
            // Clear previous results
            clearResults();
            
            log('Starting comprehensive Task 8 advanced features testing', 'info');
            
            try {
                await testNovaPremier();
                await testFundingAnalysis();
                await testFollowOnAnalysis();
                await testRichContentDisplay();
                await testExportFeatures();
                await testPerformanceStandards();
                
                log('All tests completed successfully', 'success');
                
            } catch (error) {
                log(`Testing failed: ${error.message}`, 'error');
            } finally {
                runButton.innerHTML = originalContent;
                runButton.disabled = false;
            }
        }

        async function testNovaPremier() {
            log('Testing Nova Premier model integration...', 'info');
            
            try {
                // Test basic Nova Premier analysis
                const basicResult = await callAPI('/api/analyze', TEST_SCENARIOS.novaPremierBasic);
                
                if (basicResult.formattedSummaryText && basicResult.formattedSummaryText.length > 1000) {
                    addTestResult('novaPremierTests', 'Nova Premier Basic Analysis', 
                        'Enhanced analysis with detailed insights', 'success',
                        `Analysis length: ${basicResult.formattedSummaryText.length} characters`);
                } else {
                    addTestResult('novaPremierTests', 'Nova Premier Basic Analysis',
                        'Analysis may be too brief for Nova Premier', 'warning',
                        `Analysis length: ${basicResult.formattedSummaryText?.length || 0} characters`);
                }
                
                // Test confidence scoring
                if (basicResult.metrics && basicResult.metrics.confidenceScore !== undefined) {
                    addTestResult('novaPremierTests', 'Confidence Scoring',
                        'Nova Premier provides confidence assessment', 'success',
                        `Confidence: ${basicResult.metrics.confidenceScore}% (${basicResult.metrics.confidence})`);
                } else {
                    addTestResult('novaPremierTests', 'Confidence Scoring',
                        'Missing confidence scoring in Nova Premier analysis', 'error');
                }
                
                // Test enhanced metrics
                if (basicResult.metrics && Object.keys(basicResult.metrics).length >= 5) {
                    addTestResult('novaPremierTests', 'Enhanced Metrics',
                        'Comprehensive metrics provided', 'success',
                        `Metrics count: ${Object.keys(basicResult.metrics).length}`);
                } else {
                    addTestResult('novaPremierTests', 'Enhanced Metrics',
                        'Limited metrics in Nova Premier analysis', 'warning');
                }
                
                log('Nova Premier testing completed', 'success');
                
            } catch (error) {
                addTestResult('novaPremierTests', 'Nova Premier Integration',
                    'Failed to test Nova Premier functionality', 'error', error.message);
                log(`Nova Premier testing failed: ${error.message}`, 'error');
            }
        }

        async function testFundingAnalysis() {
            log('Testing funding analysis workflow...', 'info');
            
            try {
                const fundingResult = await callAPI('/api/analyze', TEST_SCENARIOS.fundingStandard);
                
                // Check for funding content
                const fundingContent = fundingResult.fundingOptions || fundingResult.fundingAnalysis || '';
                
                if (fundingContent && fundingContent.length > 200) {
                    addTestResult('fundingTests', 'Funding Analysis Content',
                        'Comprehensive funding analysis provided', 'success',
                        `Content length: ${fundingContent.length} characters`);
                } else {
                    addTestResult('fundingTests', 'Funding Analysis Content',
                        'Funding analysis content may be insufficient', 'warning',
                        `Content length: ${fundingContent.length} characters`);
                }
                
                // Check for funding keywords
                const fundingKeywords = ['funding', 'investment', 'financing', 'capital', 'budget'];
                const hasKeywords = fundingKeywords.some(keyword => 
                    fundingContent.toLowerCase().includes(keyword)
                );
                
                if (hasKeywords) {
                    addTestResult('fundingTests', 'Funding Terminology',
                        'Appropriate financial terminology used', 'success');
                } else {
                    addTestResult('fundingTests', 'Funding Terminology',
                        'Missing relevant funding terminology', 'error');
                }
                
                // Test funding workflow completeness
                if (fundingResult.fundingMetadata || fundingResult.fundingOptions) {
                    addTestResult('fundingTests', 'Funding Workflow',
                        'Complete funding analysis workflow', 'success');
                } else {
                    addTestResult('fundingTests', 'Funding Workflow',
                        'Funding workflow may be incomplete', 'warning');
                }
                
                log('Funding analysis testing completed', 'success');
                
            } catch (error) {
                addTestResult('fundingTests', 'Funding Analysis Workflow',
                    'Failed to test funding analysis', 'error', error.message);
                log(`Funding analysis testing failed: ${error.message}`, 'error');
            }
        }

        async function testFollowOnAnalysis() {
            log('Testing follow-on opportunity analysis...', 'info');
            
            try {
                const followOnResult = await callAPI('/api/analyze', TEST_SCENARIOS.followOnBasic);
                
                // Check for follow-on content
                const followOnContent = followOnResult.followOnOpportunities || followOnResult.followOnAnalysis || '';
                
                if (followOnContent && followOnContent.length > 200) {
                    addTestResult('followOnTests', 'Follow-On Analysis Content',
                        'Comprehensive follow-on analysis provided', 'success',
                        `Content length: ${followOnContent.length} characters`);
                } else {
                    addTestResult('followOnTests', 'Follow-On Analysis Content',
                        'Follow-on analysis content may be insufficient', 'warning',
                        `Content length: ${followOnContent.length} characters`);
                }
                
                // Check for growth keywords
                const growthKeywords = ['growth', 'expansion', 'opportunity', 'next', 'future', 'additional'];
                const hasGrowthKeywords = growthKeywords.some(keyword =>
                    followOnContent.toLowerCase().includes(keyword)
                );
                
                if (hasGrowthKeywords) {
                    addTestResult('followOnTests', 'Growth Terminology',
                        'Appropriate growth terminology used', 'success');
                } else {
                    addTestResult('followOnTests', 'Growth Terminology',
                        'Missing relevant growth terminology', 'error');
                }
                
                // Test multi-step workflow indicators
                if (followOnResult.followOnMetadata || followOnResult.timeline) {
                    addTestResult('followOnTests', 'Multi-Step Workflow',
                        'Multi-step workflow indicators present', 'success');
                } else {
                    addTestResult('followOnTests', 'Multi-Step Workflow',
                        'Multi-step workflow may be incomplete', 'warning');
                }
                
                log('Follow-on analysis testing completed', 'success');
                
            } catch (error) {
                addTestResult('followOnTests', 'Follow-On Analysis Workflow',
                    'Failed to test follow-on analysis', 'error', error.message);
                log(`Follow-on analysis testing failed: ${error.message}`, 'error');
            }
        }

        async function testRichContentDisplay() {
            log('Testing rich formatted content display...', 'info');
            
            try {
                const contentResult = await callAPI('/api/analyze', TEST_SCENARIOS.novaPremierBasic);
                
                // Test six core analysis sections
                const requiredSections = ['methodology', 'findings', 'riskFactors', 'similarProjects', 'rationale', 'fullAnalysis'];
                let sectionsFound = 0;
                
                for (const section of requiredSections) {
                    const sectionContent = contentResult[section] || contentResult.sections?.[section] || '';
                    
                    if (sectionContent && sectionContent.length > 50) {
                        sectionsFound++;
                        addTestResult('contentTests', `${section} Section`,
                            'Section content available', 'success',
                            `Length: ${sectionContent.length} characters`);
                    } else {
                        addTestResult('contentTests', `${section} Section`,
                            'Section content missing or too brief', 'warning',
                            `Length: ${sectionContent.length} characters`);
                    }
                }
                
                // Overall sections assessment
                if (sectionsFound >= 4) {
                    addTestResult('contentTests', 'Analysis Sections Coverage',
                        'Most analysis sections available', 'success',
                        `${sectionsFound}/6 sections found`);
                } else {
                    addTestResult('contentTests', 'Analysis Sections Coverage',
                        'Insufficient analysis sections', 'error',
                        `${sectionsFound}/6 sections found`);
                }
                
                // Test content formatting
                const content = contentResult.formattedSummaryText || '';
                const hasFormatting = content.includes('**') || content.includes('###') || content.includes('===');
                
                if (hasFormatting) {
                    addTestResult('contentTests', 'Content Formatting',
                        'Rich formatting markers present', 'success');
                } else {
                    addTestResult('contentTests', 'Content Formatting',
                        'Limited formatting in content', 'warning');
                }
                
                log('Rich content display testing completed', 'success');
                
            } catch (error) {
                addTestResult('contentTests', 'Rich Content Display',
                    'Failed to test content display', 'error', error.message);
                log(`Rich content display testing failed: ${error.message}`, 'error');
            }
        }

        async function testExportFeatures() {
            log('Testing export and print capabilities...', 'info');
            
            try {
                const exportResult = await callAPI('/api/analyze', TEST_SCENARIOS.fundingStandard);
                
                // Test data completeness for export
                const hasCompleteData = exportResult.metrics && exportResult.formattedSummaryText;
                
                if (hasCompleteData) {
                    addTestResult('exportTests', 'Export Data Completeness',
                        'Complete data structure for export', 'success');
                } else {
                    addTestResult('exportTests', 'Export Data Completeness',
                        'Incomplete data structure for export', 'error');
                }
                
                // Test exportable fields
                const exportableFields = ['metrics', 'methodology', 'findings', 'riskFactors', 'similarProjects', 'rationale', 'fullAnalysis'];
                const availableFields = exportableFields.filter(field => 
                    exportResult[field] || exportResult.sections?.[field]
                );
                
                if (availableFields.length >= 5) {
                    addTestResult('exportTests', 'Exportable Fields',
                        'Most fields available for export', 'success',
                        `${availableFields.length}/7 fields available`);
                } else {
                    addTestResult('exportTests', 'Exportable Fields',
                        'Limited fields for export', 'warning',
                        `${availableFields.length}/7 fields available`);
                }
                
                // Test metadata for export tracking
                const hasMetadata = exportResult.timestamp || exportResult.sessionId || exportResult.opportunityId;
                
                if (hasMetadata) {
                    addTestResult('exportTests', 'Export Metadata',
                        'Metadata available for export tracking', 'success');
                } else {
                    addTestResult('exportTests', 'Export Metadata',
                        'Missing metadata for export tracking', 'warning');
                }
                
                // Test print functionality (frontend feature)
                addTestResult('exportTests', 'Print Functionality',
                    'Print functionality requires frontend testing', 'warning',
                    'Manual testing required for print capabilities');
                
                log('Export features testing completed', 'success');
                
            } catch (error) {
                addTestResult('exportTests', 'Export and Print Features',
                    'Failed to test export features', 'error', error.message);
                log(`Export features testing failed: ${error.message}`, 'error');
            }
        }

        async function testPerformanceStandards() {
            log('Testing performance and reliability standards...', 'info');
            
            try {
                // Test response times
                const startTime = Date.now();
                const perfResult = await callAPI('/api/analyze', TEST_SCENARIOS.novaPremierBasic);
                const duration = Date.now() - startTime;
                
                if (duration < 30000) { // 30 second threshold
                    addTestResult('performanceTests', 'Response Time',
                        'Analysis completed within time threshold', 'success',
                        `Duration: ${duration}ms`);
                } else {
                    addTestResult('performanceTests', 'Response Time',
                        'Analysis exceeded time threshold', 'warning',
                        `Duration: ${duration}ms (>30s)`);
                }
                
                // Test system health
                try {
                    const healthResponse = await fetch(`${API_BASE}/health`);
                    const healthData = await healthResponse.json();
                    
                    if (healthData.status === 'healthy') {
                        addTestResult('performanceTests', 'System Health',
                            'System reporting healthy status', 'success');
                    } else {
                        addTestResult('performanceTests', 'System Health',
                            'System health issues detected', 'warning',
                            `Status: ${healthData.status}`);
                    }
                } catch (healthError) {
                    addTestResult('performanceTests', 'System Health',
                        'Health check endpoint unavailable', 'warning');
                }
                
                // Test error handling
                try {
                    await callAPI('/api/analyze', {
                        CustomerName: "", // Invalid data
                        region: "",
                        closeDate: "",
                        oppName: "",
                        oppDescription: ""
                    });
                    
                    addTestResult('performanceTests', 'Error Handling',
                        'System may not be validating input properly', 'warning');
                        
                } catch (validationError) {
                    addTestResult('performanceTests', 'Error Handling',
                        'System properly handles invalid input', 'success');
                }
                
                // Test concurrent requests (simplified)
                addTestResult('performanceTests', 'Concurrent Requests',
                    'Concurrent testing requires load testing tools', 'warning',
                    'Manual load testing recommended');
                
                log('Performance standards testing completed', 'success');
                
            } catch (error) {
                addTestResult('performanceTests', 'Performance Standards',
                    'Failed to test performance standards', 'error', error.message);
                log(`Performance standards testing failed: ${error.message}`, 'error');
            }
        }

        // Demo functions
        async function demoNovaPremierBasic() {
            log('Running Nova Premier basic analysis demo...', 'info');
            try {
                const result = await callAPI('/api/analyze', TEST_SCENARIOS.novaPremierBasic);
                log(`Nova Premier analysis completed: ${result.formattedSummaryText?.length || 0} characters`, 'success');
            } catch (error) {
                log(`Nova Premier demo failed: ${error.message}`, 'error');
            }
        }

        async function demoFundingStandard() {
            log('Running standard funding analysis demo...', 'info');
            try {
                const result = await callAPI('/api/analyze', TEST_SCENARIOS.fundingStandard);
                const fundingContent = result.fundingOptions || result.fundingAnalysis || '';
                log(`Funding analysis completed: ${fundingContent.length} characters`, 'success');
            } catch (error) {
                log(`Funding demo failed: ${error.message}`, 'error');
            }
        }

        async function demoFollowOnBasic() {
            log('Running basic follow-on analysis demo...', 'info');
            try {
                const result = await callAPI('/api/analyze', TEST_SCENARIOS.followOnBasic);
                const followOnContent = result.followOnOpportunities || result.followOnAnalysis || '';
                log(`Follow-on analysis completed: ${followOnContent.length} characters`, 'success');
            } catch (error) {
                log(`Follow-on demo failed: ${error.message}`, 'error');
            }
        }

        function clearResults() {
            // Clear all test result containers
            const containers = ['novaPremierTests', 'fundingTests', 'followOnTests', 'contentTests', 'exportTests', 'performanceTests'];
            containers.forEach(container => {
                const element = document.getElementById(container);
                if (element) element.innerHTML = '';
            });
            
            // Reset metrics
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0, details: [] };
            updateMetrics();
            
            // Clear log
            document.getElementById('logOutput').innerHTML = '';
            document.getElementById('logOutput').classList.add('hidden');
            
            log('Test results cleared', 'info');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            log('Task 8 Advanced Features Validation Tool loaded', 'info');
            log('Click "Run All Tests" to begin comprehensive testing', 'info');
        });
    </script>
</body>
</html>